<ion-content
  class="bg-gradient-to-br from-[#FFF0E6] via-white to-[#FFE0D0] dark:from-gray-900 dark:to-gray-800"
  scrollEvents="true"
  [scrollY]="true"
  forceOverscroll="true"
  (ionRefresh)="doRefresh($event)"
>
  <ion-refresher slot="fixed">
    <ion-refresher-content
      pullingIcon=""
      pullingText=""
      refreshingSpinner="circles"
      refreshingText=""
    >
    </ion-refresher-content>
  </ion-refresher>

  <!-- Header with profile summary -->
  <div
    class="px-4 sm:px-6 pt-6 pb-4 sticky top-0 z-10 bg-gradient-to-r from-[#BB3E00]/90 to-[#A03500]/90 dark:from-[#BB3E00]/80 dark:to-[#A03500]/80 backdrop-blur-md shadow-md"
  >
    <div class="flex items-center justify-between">
      <div>
        <h1 class="text-white text-xl font-bold">Halo, {{ userName }}</h1>
        <p class="text-white/80 text-sm mt-1">Selamat datang kembali</p>
      </div>
      <div class="flex items-center">
        <div class="relative w-10 h-10">
          <button 
            class="w-full h-full bg-white/20 rounded-full flex items-center justify-center focus:outline-none focus:ring-2 focus:ring-white/50 active:bg-white/30 transition-all duration-150"
            (click)="toggleNotificationPopup()"
          >
            <ion-icon
              name="notifications-outline"
              class="text-white text-xl"
            ></ion-icon>
          </button>
          <span
            *ngIf="notificationCount > 0"
            class="absolute top-0 right-0 bg-red-500 text-white text-xs w-5 h-5 flex items-center justify-center rounded-full translate-x-1/2 -translate-y-1/2"
          >
            {{ notificationCount }}
          </span>
        </div>
        
        <!-- Notification Popup -->
        <div *ngIf="showNotifications" class="absolute right-0 top-12 w-72 md:w-80 bg-white dark:bg-gray-800 rounded-lg shadow-lg z-50 overflow-hidden mx-2 sm:mx-0">
          <div class="p-3 bg-gray-50 dark:bg-gray-700 border-b border-gray-200 dark:border-gray-600">
            <div class="flex items-center justify-between">
              <h3 class="text-sm font-medium text-gray-700 dark:text-gray-200">Notifikasi</h3>
              <div class="flex items-center space-x-3">
                <span class="text-xs text-[#BB3E00] dark:text-[#FF6B2B] cursor-pointer" (click)="markAllAsRead()">Tandai sudah dibaca</span>
                <button class="text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200" (click)="toggleNotificationPopup()">
                  <ion-icon name="close-outline" class="text-lg"></ion-icon>
                </button>
              </div>
            </div>
          </div>
          <div class="max-h-60 sm:max-h-80 overflow-y-auto">
            <div *ngFor="let notification of notifications" class="p-3 border-b border-gray-100 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-750 cursor-pointer">
              <div class="flex items-start">
                <div class="flex-shrink-0 mr-3">
                  <div class="w-8 h-8 rounded-full bg-[#FFF0E6] dark:bg-[#3D1500] flex items-center justify-center">
                    <ion-icon name="document-text" class="text-[#BB3E00] dark:text-[#FF6B2B]"></ion-icon>
                  </div>
                </div>
                <div class="flex-1">
                  <p class="text-sm font-medium text-gray-800 dark:text-gray-200">{{ notification.title }}</p>
                  <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">{{ notification.message }}</p>
                  <p class="text-xs text-gray-400 dark:text-gray-500 mt-1">{{ notification.time }}</p>
                </div>
                <div *ngIf="!notification.read" class="w-2 h-2 bg-[#BB3E00] rounded-full"></div>
              </div>
            </div>
          </div>
          <div *ngIf="notifications.length === 0" class="p-4 text-center text-gray-500 dark:text-gray-400 text-sm">
            Tidak ada notifikasi
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Main content with card layout -->
  <div class="px-4 sm:px-6 py-4">
    <!-- Quick Stats Cards -->
    <div class="grid grid-cols-2 gap-3 mb-6">
      <div
        class="bg-white dark:bg-gray-700 rounded-xl shadow-sm p-4 border-l-4 border-[#BB3E00]"
      >
        <div class="flex items-center justify-between">
          <div>
            <p class="text-gray-500 dark:text-gray-300 text-xs">
              Surat Diajukan
            </p>
            <h3 class="text-2xl font-bold text-gray-800 dark:text-white mt-1">
              12
            </h3>
          </div>
          <div
            class="w-10 h-10 bg-[#FFF0E6] dark:bg-[#3E2A23] rounded-full flex items-center justify-center"
          >
            <ion-icon
              name="document-text"
              class="text-[#BB3E00] text-xl"
            ></ion-icon>
          </div>
        </div>
      </div>

      <div
        class="bg-white dark:bg-gray-700 rounded-xl shadow-sm p-4 border-l-4 border-green-500"
      >
        <div class="flex items-center justify-between">
          <div>
            <p class="text-gray-500 dark:text-gray-300 text-xs">
              Surat Disetujui
            </p>
            <h3 class="text-2xl font-bold text-gray-800 dark:text-white mt-1">
              8
            </h3>
          </div>
          <div
            class="w-10 h-10 bg-green-100 dark:bg-green-900/30 rounded-full flex items-center justify-center"
          >
            <ion-icon
              name="checkmark-circle"
              class="text-green-600 dark:text-green-400 text-xl"
            ></ion-icon>
          </div>
        </div>
      </div>
    </div>

    <!-- Quick Actions -->
    <div class="mb-6">
      <h2
        class="text-lg font-bold text-gray-800 dark:text-white mb-3 flex items-center"
      >
        <ion-icon name="flash" class="mr-2 text-[#BB3E00]"></ion-icon>
        Aksi Cepat
      </h2>
      <div class="grid grid-cols-4 gap-2">
        <div
          class="flex flex-col items-center"
          routerLink="/pengajuansurat"
          routerDirection="root"
        >
          <div
            class="w-14 h-14 bg-white dark:bg-gray-700 rounded-full shadow-sm flex items-center justify-center mb-2 border-2 border-[#BB3E00]/20"
          >
            <ion-icon
              name="document-text-outline"
              class="text-[#BB3E00] text-xl"
            ></ion-icon>
          </div>
          <span class="text-xs text-center text-gray-700 dark:text-gray-300"
            >Ajukan Surat</span
          >
        </div>

        <div
          class="flex flex-col items-center"
          routerLink="/templatesurat"
          routerDirection="root"
        >
          <div
            class="w-14 h-14 bg-white dark:bg-gray-700 rounded-full shadow-sm flex items-center justify-center mb-2 border-2 border-[#BB3E00]/20"
          >
            <ion-icon
              name="copy-outline"
              class="text-[#BB3E00] text-xl"
            ></ion-icon>
          </div>
          <span class="text-xs text-center text-gray-700 dark:text-gray-300"
            >Template</span
          >
        </div>

        <div
          class="flex flex-col items-center"
          routerLink="/riwayatsurat"
          routerDirection="root"
        >
          <div
            class="w-14 h-14 bg-white dark:bg-gray-700 rounded-full shadow-sm flex items-center justify-center mb-2 border-2 border-[#BB3E00]/20"
          >
            <ion-icon
              name="time-outline"
              class="text-[#BB3E00] text-xl"
            ></ion-icon>
          </div>
          <span class="text-xs text-center text-gray-700 dark:text-gray-300"
            >Riwayat</span
          >
        </div>

        <div class="flex flex-col items-center">
          <div
            class="w-14 h-14 bg-white dark:bg-gray-700 rounded-full shadow-sm flex items-center justify-center mb-2 border-2 border-[#BB3E00]/20"
          >
            <ion-icon
              name="help-outline"
              class="text-[#BB3E00] text-xl"
            ></ion-icon>
          </div>
          <span class="text-xs text-center text-gray-700 dark:text-gray-300"
            >Bantuan</span
          >
        </div>
      </div>
    </div>

    <!-- Popular Services -->
    <div class="mb-6">
      <h2
        class="text-lg font-bold text-gray-800 dark:text-white mb-3 flex items-center"
      >
        <ion-icon name="star" class="mr-2 text-[#BB3E00]"></ion-icon>
        Layanan Populer
      </h2>

      <div class="space-y-3">
        <!-- Service 1 -->
        <div
          class="bg-white dark:bg-gray-700 rounded-xl shadow-sm p-4 flex items-center"
        >
          <div
            class="w-12 h-12 rounded-full bg-[#FFF0E6] dark:bg-[#3E2A23] flex items-center justify-center mr-4"
          >
            <ion-icon
              name="document-text"
              class="text-[#BB3E00] text-xl"
            ></ion-icon>
          </div>
          <div class="flex-1">
            <h4 class="font-medium text-gray-800 dark:text-white">
              Surat Keterangan
            </h4>
            <p class="text-xs text-gray-500 dark:text-gray-300 mt-1">
              Dokumen umum untuk berbagai keperluan
            </p>
          </div>
          <ion-button fill="clear" class="h-8 text-[#BB3E00]">
            <ion-icon name="arrow-forward" slot="icon-only"></ion-icon>
          </ion-button>
        </div>

        <!-- Service 2 -->
        <div
          class="bg-white dark:bg-gray-700 rounded-xl shadow-sm p-4 flex items-center"
        >
          <div
            class="w-12 h-12 rounded-full bg-[#FFF0E6] dark:bg-[#3E2A23] flex items-center justify-center mr-4"
          >
            <ion-icon name="card" class="text-[#BB3E00] text-xl"></ion-icon>
          </div>
          <div class="flex-1">
            <h4 class="font-medium text-gray-800 dark:text-white">
              Kartu Identitas
            </h4>
            <p class="text-xs text-gray-500 dark:text-gray-300 mt-1">
              Pembuatan & perpanjangan identitas
            </p>
          </div>
          <ion-button fill="clear" class="h-8 text-[#BB3E00]">
            <ion-icon name="arrow-forward" slot="icon-only"></ion-icon>
          </ion-button>
        </div>
      </div>
    </div>

    <!-- Help & Support -->
    <div class="mb-8">
      <div
        class="bg-gradient-to-r from-[#BB3E00] to-[#A03500] dark:from-[#BB3E00]/80 dark:to-[#A03500]/80 rounded-xl shadow-md p-5 text-white"
      >
        <div class="flex items-center">
          <div class="mr-4">
            <ion-icon name="headset" class="text-3xl"></ion-icon>
          </div>
          <div class="flex-1">
            <h3 class="font-bold text-lg mb-1">Butuh bantuan?</h3>
            <p class="text-white/80 text-sm mb-3">
              Tim kami siap membantu Anda 24/7
            </p>
            <ion-button
              fill="solid"
              color="light"
              size="small"
              class="text-[#BB3E00] font-medium"
            >
              Hubungi Kami
            </ion-button>
          </div>
        </div>
      </div>
    </div>
  </div>
</ion-content>

<!-- Tab Navigation -->
<ion-tab-bar
  slot="bottom"
  class="bg-white dark:bg-gray-800 border-t border-gray-100 dark:border-gray-700 h-16"
>
  <ion-tab-button
    tab="dashboard"
    routerLink="/dashboard"
    routerDirection="root"
    routerLinkActive="tab-selected"
    class="text-xs"
  >
    <div class="flex flex-col items-center justify-center">
      <div class="w-6 h-6 flex items-center justify-center mb-1">
        <ion-icon name="grid" class="text-xl"></ion-icon>
      </div>
      <ion-label>Beranda</ion-label>
    </div>
  </ion-tab-button>

  <ion-tab-button
    tab="aktivitas"
    routerLink="/aktivitas"
    routerDirection="root"
    routerLinkActive="tab-selected"
    class="text-xs"
  >
    <div class="flex flex-col items-center justify-center">
      <div class="w-6 h-6 flex items-center justify-center mb-1">
        <ion-icon name="pulse" class="text-xl"></ion-icon>
      </div>
      <ion-label>Aktivitas</ion-label>
    </div>
  </ion-tab-button>

  <ion-tab-button
    tab="riwayat"
    routerLink="/riwayatsurat"
    routerDirection="root"
    routerLinkActive="tab-selected"
    class="text-xs"
  >
    <div class="flex flex-col items-center justify-center">
      <div class="w-6 h-6 flex items-center justify-center mb-1">
        <ion-icon name="time" class="text-xl"></ion-icon>
      </div>
      <ion-label>Riwayat</ion-label>
    </div>
  </ion-tab-button>

  <ion-tab-button
    tab="profile"
    routerLink="/profile"
    routerDirection="root"
    routerLinkActive="tab-selected"
    class="text-xs"
  >
    <div class="flex flex-col items-center justify-center">
      <div class="w-6 h-6 flex items-center justify-center mb-1">
        <ion-icon name="person" class="text-xl"></ion-icon>
      </div>
      <ion-label>Profil</ion-label>
    </div>
  </ion-tab-button>
</ion-tab-bar>  